<script>
  navigator.serviceWorker.getRegistrations().then(function(registrations) {
    if(!registrations.length) {
      navigator.serviceWorker.register("/sw.js").then(function() {
        location.reload(true);
      }, function(err) {
        location.replace("/FatalError.sh?~="+encodeURIComponent(err));
      });
    } else {
      location.replace("/FatalError.sh?~="+encodeURIComponent("This page isn't working"));
    }
  }, function(err) {
    location.replace("/FatalError.sh?~="+encodeURIComponent(err));
  });
</script>
